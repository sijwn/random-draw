<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Îü≠ÌÇ§ Î∞ïÏä§ Ï°∞ Ï∂îÏ≤® ÏãúÏä§ÌÖú</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@900&display=swap');
        body { margin: 0; background: #050510; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; }
        
        #intro-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 16, 0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 2000; transition: 0.8s;
        }
        #intro-btn {
            padding: 25px 65px; font-size: 2.2rem; cursor: pointer; border: none; border-radius: 100px;
            color: white; font-weight: bold; background: linear-gradient(45deg, #ff0055, #ff4d6d);
            box-shadow: 0 0 35px rgba(255, 0, 85, 0.5); transition: 0.3s;
        }
        #ui { position: absolute; top: 30px; width: 100%; text-align: center; z-index: 1000; pointer-events: none; opacity: 0; transition: 0.8s; }
        .btn-group { display: flex; justify-content: center; gap: 20px; pointer-events: auto; }
        button#draw-btn { 
            padding: 15px 45px; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 50px; 
            color: white; font-weight: bold; background: linear-gradient(45deg, #00d2ff, #3a7bd5);
        }
        button:disabled { background: #444; cursor: not-allowed; }
        #status-text { color: #fff; font-size: 2.2rem; text-shadow: 0 0 15px #00d2ff; margin-bottom: 15px; min-height: 50px; }
    </style>
</head>
<body>
    <div id="intro-layer">
        <div style="color: #00d2ff; font-size: 3.5rem; margin-bottom: 45px;">LUCKY DRAW</div>
        <button id="intro-btn" onclick="startEverything()">Ï∂îÏ≤® ÏãúÏûë</button>
    </div>

    <div id="ui">
        <div id="status-text">Ï∂îÏ≤® Ï§ÄÎπÑ</div>
        <div class="btn-group">
            <button id="draw-btn" onclick="handleDrawClick()">Îã§Ïùå ÌïôÏÉù Ï∂îÏ≤®</button>
        </div>
    </div>

    <script>
        const { Engine, Render, Runner, Bodies, Composite, Body, Events, Mouse, MouseConstraint } = Matter;
        const engine = Engine.create();
        const render = Render.create({
            element: document.body, engine: engine,
            options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
        });

        // üîä Ïò§ÎîîÏò§ ÏÑ§Ï†ï (Î≥ºÎ•® Î∞∏Îü∞Ïä§ Ï°∞Ï†ï)
        const bgm = new Audio("quizbackground.mp3");
        bgm.loop = true;
        bgm.volume = 0.05; // Î∞∞Í≤ΩÏùå Îçî ÏûëÍ≤å (Í∏∞Ï°¥Ïùò 50% ÏàòÏ§Ä)

        const sfxTada = new Audio("tada.mp3");
        sfxTada.volume = 1.0; // Ìö®Í≥ºÏùå ÌÅ¨Í≤å (Î∏åÎùºÏö∞Ï†Ä ÏµúÎåÄÏπò)

        const sfxSuccess = new Audio("https://actions.google.com/sounds/v1/cartoon/clink_clank.ogg");
        sfxSuccess.volume = 1.0;

        const groupsData = {
            1: ["Í≥µÏõêÌÉú", "Í∞ïÌïòÎäò", "Í∞ïÏú§ÏïÑ", "Ïù¥ÏÇ¨Îûë", "ÎÇ®ÌïòÏ§Ä", "Î∞ïÏÜåÎã¥", "Î∞ïÏÜåÏú§"].sort(() => Math.random() - 0.5),
            2: ["ÍπÄÏò®Ïú†", "Ïã†ÏàòÏó∞", "ÍπÄÌïòÏú§", "Ïû•ÏßÄÏö∞", "Ïû•ÏàòÏó∞", "Í∞ïÎ°úÏù¥", "Ïù¥ÎØºÏïÑ"].sort(() => Math.random() - 0.5),
            3: ["Ïù¥Í±¥Ïö∞", "Ïû•Ï£ºÌïò", "Ï†ïÏú†ÏÑù", "ÎÇ®ÌïòÏùÄ", "Í∞ïÌïòÎûå", "ÌóàÌÉúÎØº"].sort(() => Math.random() - 0.5)
        };

        let nextGroupToDraw = 1;
        let balls = [];
        let selectedBall = null;
        let animProgress = 0;
        let isTurboMode = false;

        const centerX = window.innerWidth / 2;
        const centerY = 240;
        const groupX = [window.innerWidth * 0.2, window.innerWidth * 0.5, window.innerWidth * 0.8];
        const bucketBaseY = window.innerHeight - 75;
        let groupCounters = [0, 0, 0];

        function startEverything() {
            bgm.play();
            document.getElementById('intro-layer').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-layer').style.display = 'none';
                document.getElementById('ui').style.opacity = '1';
            }, 800);

            const allNames = [...groupsData[1], ...groupsData[2], ...groupsData[3]];
            balls = allNames.map(name => {
                let gNum = 0;
                for(let g in groupsData) if(groupsData[g].includes(name)) gNum = parseInt(g);
                const b = Bodies.circle(centerX, centerY, 22, {
                    restitution: 0.95, friction: 0.001, render: { fillStyle: '#ffffff' }, label: name
                });
                b.targetGroup = gNum;
                // ‚úÖ Ìï¥Í≤∞: Ï¥àÍ∏∞ ÏÜçÎèÑÎ•º ÌôîÎ©¥ Î∞ñÏúºÎ°ú ÌäÄÏßÄ ÏïäÎäî Ï†ÅÏ†àÌïú Í∞í(*7)ÏúºÎ°ú ÏàòÏ†ï
                Body.setVelocity(b, { x: (Math.random()-0.5)*7, y: (Math.random()-0.5)*7 }); 
                return b;
            });
            Composite.add(engine.world, balls);
            buildWalls();
        }

        function handleDrawClick() {
            if (selectedBall) return;
            document.getElementById('draw-btn').disabled = true;
            document.getElementById('status-text').innerText = "ÏÑûÎäî Ï§ë...";
            sfxTada.play(); 
            isTurboMode = true; // ‚úÖ Ï∂îÏ≤® ÏãúÏûë Ïãú Í≥µ Í∞ÄÏÜç

            setTimeout(() => {
                isTurboMode = false;
                drawPhase();
            }, 2000);
        }

        function drawPhase() {
            let attempts = 0;
            while (groupsData[nextGroupToDraw].length === 0 && attempts < 3) {
                nextGroupToDraw = (nextGroupToDraw % 3) + 1;
                attempts++;
            }
            if (groupsData[nextGroupToDraw].length === 0) {
                document.getElementById('status-text').innerText = "Î™®Îì† ÌïôÏÉù Ìé∏ÏÑ± ÏôÑÎ£å!";
                return;
            }
            const targetName = groupsData[nextGroupToDraw].shift();
            selectedBall = balls.find(b => b.label === targetName);
            document.getElementById('status-text').innerText = `${targetName} - ${selectedBall.targetGroup}Ï°∞ ÎãπÏ≤®!`;
            animProgress = 0;
            selectedBall.startPos = { x: selectedBall.position.x, y: selectedBall.position.y };
            Body.setStatic(selectedBall, true);
            nextGroupToDraw = (nextGroupToDraw % 3) + 1;
        }

        function placeBall() {
            sfxSuccess.play();
            const groupIdx = selectedBall.targetGroup - 1;
            const count = groupCounters[groupIdx];
            const col = count % 2;
            const row = Math.floor(count / 2);
            const targetX = groupX[groupIdx] + (col === 0 ? -34 : 34);
            const targetY = bucketBaseY - (row * 50) - 25;

            selectedBall.isHighlighted = false;
            Body.setPosition(selectedBall, { x: targetX, y: targetY });
            groupCounters[groupIdx]++;
            document.getElementById('status-text').innerText = "Ï∂îÏ≤® Ï§ÄÎπÑ";
            selectedBall = null;
            document.getElementById('draw-btn').disabled = false;
        }

        Events.on(engine, 'beforeUpdate', () => {
            if (selectedBall && animProgress < 1) {
                animProgress += 0.025;
                const lerpX = selectedBall.startPos.x + (centerX - selectedBall.startPos.x) * animProgress;
                const lerpY = selectedBall.startPos.y + (centerY - selectedBall.startPos.y) * animProgress;
                Body.setPosition(selectedBall, { x: lerpX, y: lerpY });
                selectedBall.isHighlighted = true;
            }
            balls.forEach(b => {
                if(!b.isStatic && !b.isHighlighted) {
                    // ‚úÖ ÎåÄÍ∏∞ Ï§ë ÏÜçÎèÑ: 0.035 / Ï∂îÏ≤® Ï§ë ÏÜçÎèÑ: 0.06 (Í∏∞Ï°¥Î≥¥Îã§ Îπ†Î¶Ñ)
                    const forceMag = isTurboMode ? 0.06 : 0.035; 
                    Body.applyForce(b, b.position, { x: (Math.random()-0.5)*forceMag, y: (Math.random()-0.5)*forceMag });
                    
                    const dist = Math.sqrt((b.position.x - centerX)**2 + (b.position.y - centerY)**2);
                    if(dist > 182) {
                        const angle = Math.atan2(centerY - b.position.y, centerX - b.position.x);
                        Body.setPosition(b, { x: centerX + Math.cos(angle)*175, y: centerY + Math.sin(angle)*175 });
                    }
                }
            });
        });

        Events.on(render, 'afterRender', () => {
            const ctx = render.context;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            balls.forEach(b => {
                if (!b.isHighlighted) {
                    ctx.fillStyle = "black";
                    ctx.font = "bold 13px Noto Sans KR";
                    ctx.fillText(b.label, b.position.x, b.position.y);
                }
            });
            if (selectedBall) {
                const currentRadius = 22 + (animProgress * 58);
                ctx.save();
                ctx.translate(selectedBall.position.x, selectedBall.position.y);
                ctx.beginPath();
                ctx.arc(0, 0, currentRadius, 0, Math.PI*2);
                ctx.fillStyle = "#ff0055";
                ctx.fill();
                ctx.strokeStyle = "#fff";
                ctx.lineWidth = 4;
                ctx.stroke();
                ctx.fillStyle = "white";
                ctx.font = `bold ${14 + (animProgress * 20)}px Noto Sans KR`;
                ctx.fillText(selectedBall.label, 0, 0);
                ctx.restore();
            }
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 26px Noto Sans KR";
            groupX.forEach((x, i) => ctx.fillText(`${i+1}Ï°∞`, x, window.innerHeight - 40));
        });

        function buildWalls() {
            for(let i=0; i<40; i++){
                const angle = (Math.PI*2/40)*i;
                Composite.add(engine.world, Bodies.rectangle(centerX + Math.cos(angle)*200, centerY + Math.sin(angle)*200, 60, 60, {
                    isStatic: true, angle: angle + Math.PI/2, render: { fillStyle: 'transparent', strokeStyle: '#00d2ff', lineWidth: 2 }
                }));
            }
            groupX.forEach(x => {
                Composite.add(engine.world, Bodies.rectangle(x, window.innerHeight - 10, 180, 20, { isStatic: true, render: { fillStyle: '#00d2ff' }}));
            });
        }

        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, { mouse: mouse });
        Events.on(mouseConstraint, 'mousedown', (event) => {
            if (selectedBall && animProgress >= 1 && Matter.Bounds.contains(selectedBall.bounds, event.mouse.position)) {
                placeBall();
            }
        });

        Runner.run(Runner.create(), engine);
        Render.run(render);
    </script>
</body>
</html>
